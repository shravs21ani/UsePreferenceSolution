name: Test CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  test-pipeline:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v5
      
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'
        
    - name: Test .NET version
      run: dotnet --version
      
    - name: Restore dependencies
      run: dotnet restore
      
    - name: Build solution
      run: dotnet build --no-restore --configuration Release
      
    - name: Run tests
      run: dotnet test --no-build --verbosity normal --configuration Release
      
    - name: Test Bicep validation
      run: |
        echo "ğŸ” Testing Bicep template..."
        az bicep build --file infra/main.bicep
        echo "âœ… Bicep template is valid!"
      
    - name: Success message
      run: |
        echo "ğŸ‰ Test CI/CD Pipeline completed successfully!"
        echo ""
        echo "âœ… .NET 8.0 SDK working"
        echo "âœ… Dependencies restored"
        echo "âœ… Solution built successfully"
        echo "âœ… Tests passed"
        echo "âœ… Bicep template validated"
        echo ""
        echo "ğŸš€ Your CI/CD pipeline is ready!"
        echo "Next: Configure Azure resources and uncomment deployment jobs"
